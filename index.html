<!DOCTYPE html>
<html>
<head>
    <title>Waste Detector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #d7f0ff, #ffd9e8);
            padding: 20px;
        }

        h1 {
            color: #2a2a2a;
        }

        #container {
            background: white;
            padding: 20px;
            border-radius: 20px;
            width: 360px;
            margin: auto;
            box-shadow: 0px 4px 15px rgba(0,0,0,0.2);
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: 0.2s;
        }

        #startBtn { background-color: #4CAF50; color: white; }
        #stopBtn { background-color: #ff5252; color: white; }

        button:hover { transform: scale(1.05); }

        #detected {
            font-size: 22px;
            font-weight: bold;
            margin-top: 15px;
            color: #333;
        }

        #webcam-container {
            margin-top: 10px;
        }

        #label-container div {
            margin: 3px 0;
            padding: 6px;
            background: #f2f2f2;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <h1>Real-Time Waste Material Detector</h1>

    <div id="container">
        <button id="startBtn" onclick="init()">Start Camera</button>
        <button id="stopBtn" onclick="stop()">Stop / Reset</button>

        <!-- PROJECT GOAL PARAGRAPH PLACED RIGHT BELOW BUTTONS -->
        <p style="margin-top: 10px; font-size: 15px; color: #444;">
            The goal of this project is to use real-time image detection to identify plastic, paper, metal, and organic waste so that sorting becomes easier and more accurate. By helping users quickly recognize the type of material they are dealing with, this project aims to support better recycling habits, reduce contamination in waste bins, and promote a cleaner environment overall.
        </p>

        <div id="webcam-container"></div>

        <div id="detected">Detected: —</div>

        <h3>Confidence Scores</h3>
        <div id="label-container"></div>
    </div>

    <!-- Teachable Machine scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script type="text/javascript">
        const URL = "./my_model/";
        let model, webcam, labelContainer, maxPredictions, isRunning = false;

        async function init() {
            if (isRunning) return;
            isRunning = true;

            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            const flip = true;
            webcam = new tmImage.Webcam(250, 250, flip);
            await webcam.setup();
            await webcam.play();
            window.requestAnimationFrame(loop);

            document.getElementById("webcam-container").innerHTML = "";
            document.getElementById("webcam-container").appendChild(webcam.canvas);

            labelContainer = document.getElementById("label-container");
            labelContainer.innerHTML = "";
            for (let i = 0; i < maxPredictions; i++) {
                labelContainer.appendChild(document.createElement("div"));
            }
        }

        async function loop() {
            if (!isRunning) return;
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            let highestClass = "";
            let highestProb = 0;

            for (let i = 0; i < maxPredictions; i++) {
                let prob = prediction[i].probability;
                let name = prediction[i].className;

                labelContainer.childNodes[i].innerHTML =
                    `${name}: ${prob.toFixed(2)}`;

                if (prob > highestProb) {
                    highestProb = prob;
                    highestClass = name;
                }
            }

            document.getElementById("detected").innerHTML =
                `Detected: <span style="color:#0077cc">${highestClass}</span>`;
        }

        function stop() {
            if (webcam) {
                webcam.stop();
            }

            isRunning = false;

            document.getElementById("webcam-container").innerHTML = "";
            document.getElementById("label-container").innerHTML = "";
            document.getElementById("detected").innerText = "Detected: —";
        }
    </script>
</body>
</html>
